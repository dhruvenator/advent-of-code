import sys
from os.path import abspath, join, dirname
from re import search
sys.path.append(abspath(join(dirname(__file__), '..')))
from data.fetch import read_file_to_list

class RestroomRedoubt:
    def __init__(self):
        self.clean_data()
        self.rows = 101
        self.cols = 103

    def clean_data(self):
        data = read_file_to_list('/Users/dhruvix/Documents/Personal/aoc/data/day14.txt')
        self.robots = []
        pattern = r'(-?\d+),(-?\d+) v=(-?\d+),(-?\d+)'
        for robot in data:
            match = search(pattern, robot)
            if match:
                numbers = list(map(int, match.groups()))
                self.robots.append(numbers)

    def puzzle1(self, seconds):
        new_pos = {}
        for robot in self.robots:
            [x, y, vx, vy] = robot
            nx = (x + seconds * vx) % self.rows
            ny = (y + seconds * vy) % self.cols
            new_pos[(nx, ny)] = new_pos.get((nx, ny), 0) + 1
        q1, q2, q3, q4 = 0, 0, 0, 0
        for (x, y) in new_pos.keys():
            if x < self.rows // 2 and y < self.cols // 2:
                q1 += new_pos[(x, y)]
            elif x < self.rows // 2 and y > self.cols // 2:
                q2 += new_pos[(x, y)]
            elif x > self.rows // 2 and y < self.cols // 2:
                q3 += new_pos[(x, y)]
            elif x > self.rows // 2 and y > self.cols // 2:
                q4 += new_pos[(x, y)]
        return q1 * q2 * q3 * q4

    def puzzle2(self, seconds):
        for secs in range(seconds + 1):
            print(f'---------- seconds: {secs}----------')
            new_pos = {}
            for robot in self.robots:
                [x, y, vx, vy] = robot
                nx = (x + secs * vx) % self.rows
                ny = (y + secs * vy) % self.cols
                new_pos[(nx, ny)] = new_pos.get((nx, ny), 0) + 1
            for j in range(self.rows):
                for i in range(self.cols):
                    print(new_pos.get((i, j), '.'), end='')
                print()
            print("="*50)

rr = RestroomRedoubt()
print(rr.puzzle1(100))
print(rr.puzzle2(10000))

# ---------- seconds: 6771----------
# ...............1.......................................................................................
# .........1...........1.................................................................................
# ...............................................................1.......................................
# ..........................1...........1.1..............................................................
# .......1.......1.........................................................1.............................
# .............................1....................1....................................................
# ..1....................................................................................................
# ..1....................................................................................................
# ...........................................................1..........1................................
# .........1.............................................................................................
# ...........1......1....................................................................................
# ......................1...........................................1....................................
# .................................................................1.....1...........................1...
# ................................................................1......................................
# 1..........................................................1.......................................1...
# ................1......................................................................................
# .........1...........................................................1.................................
# ..............................1........................................................................
# .1...........................1....................1....................................................
# .......................................................................................................
# ................1......................................................................................
# .......................................................1...............................................
# .......................................................................................................
# .......1............1..................................................................1...............
# .......................................................................................................
# ..................................................................................................1....
# .......................................................................................................
# .........................................................1................................1.....1......
# .......................................................................................................
# ........................................1.............................................1................
# ................................................................1...............1......................
# ..............................................................................1........................
# ...1..........1............................1...............1.......1...................................
# ....................................................................................................1..
# .............................................................................1.........................
# .......................................................................................................
# ...............................................................................1.......................
# .......................................................................................................
# ............................1.......................1........1..........1..............................
# .....................................1.................................................................
# .......................................................................................................
# ..............1........................................................................................
# ..........................1............................................................................
# ....................................................1.........................1..................1.....
# ................1......................................................................................
# ..............1.................1...................................................1..................
# .........................................1...........1.................................................
# .............1.........................1...............................1............1..................
# ........................................................................1..............................
# ..................1....................................................................................
# .......................1....1.........................................................1................
# .1................................................................................1.................1..
# ............................1111111111111111111111111111111..........1.................................
# ............................1.............................1.......................1...........1........
# ............1...............1.............................1............................................
# ............11..............1.............................1.......................1....................
# ............................1.............................1............................................
# ............................1..............1..............1........................1...............1...
# ............................1.............111.............1............................................
# ............................1............11111............1............................................
# .......1....................1...........1111111...........1............................................
# ............................1..........111111111..........1............................................
# ..............1.............1............11111............1............................................
# ...............1............1...........1111111...........1..............1.............................
# ............................1..........111111111..........1.................................1..........
# ............................1.........11111111111.........1............................................
# ......................1.....1........1111111111111........1............................................
# .........................1..1..........111111111..........1............................................
# ............................1.........11111111111.........1............................................
# ............................1........1111111111111........1............................................
# ............................1.......111111111111111.......1............................................
# .........1..................1......11111111111111111......1............................................
# .......1..........1.........1........1111111111111........1.....................................1......
# ........1...................1.......111111111111111.......1............................................
# ............................1......11111111111111111......1...1........................................
# ...............1............1.....1111111111111111111.....1.....................1......................
# ............1...............1....111111111111111111111....1.1..........................................
# ............................1.............111.............1.........................1..................
# .................1.......1..1.............111.............1.........1..................................
# ............................1.............111.............1............................................
# .....................1......1.............................1............................................
# ...................1........1.............................1............................................
# ..............1.............1.............................1............................................
# ............................1.............................1............................................
# ............................1111111111111111111111111111111......1.....................................
# .................1.................................................1......1............................
# ......1....................................1...........................................................
# .................................................11....................................................
# .......................................................................................................
# ...............1.......................................................................................
# .................11.......1............................................................................
# .........1..........1.................................1..................1.............................
# ..................1.................................................1..................................
# ....................................................1.......................1..........................
# ...........................................................................1..............1............
# ...............1.......................................................................................
# .......................................................................................................
# ...........................................1...........................................................
# .......................................................................................................
# ....1..................................................................................................
# .................1...............................................................................1.....